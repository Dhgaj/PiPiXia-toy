# PiPiXia è„šæœ¬å·¥å…·ä½¿ç”¨æŒ‡å—

é¡¹ç›®æä¾›äº†ä¸€ç³»åˆ—ä¾¿æ·çš„è„šæœ¬å·¥å…·ï¼Œä½äº `scripts/` ç›®å½•ï¼Œç”¨äºè‡ªåŠ¨åŒ–å¸¸è§çš„å¼€å‘ä»»åŠ¡ã€‚

## è„šæœ¬åˆ—è¡¨

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `01_detect_platform.sh` | æ£€æµ‹å¹³å°å¹¶é…ç½®ç¼–è¯‘ç¯å¢ƒ | é¦–æ¬¡å®‰è£…æˆ–åˆ‡æ¢å¹³å° |
| `02_auto_build.sh` | è‡ªåŠ¨æ„å»ºç¼–è¯‘å™¨ | å¿«é€Ÿæ„å»ºé¡¹ç›® |
| `03_make_test.sh` | ç¼–è¯‘å¹¶è¿è¡Œ code/ ç›®å½•ç¤ºä¾‹ | æµ‹è¯•ç¤ºä¾‹ä»£ç  |
| `04_make_clean.sh` | æ¸…ç†æ„å»ºäº§ç‰© | æ¸…ç†é¡¹ç›® |
| `05_run_tests.sh` | è¿è¡Œ test/ ç›®å½•æµ‹è¯•å¥—ä»¶ | è¿è¡Œå®Œæ•´æµ‹è¯• |
| `06_visualize_ast.sh` | å°† AST è½¬æ¢ä¸ºå›¾å½¢åŒ–æ˜¾ç¤º | AST å¯è§†åŒ– |
| `07_build_code.sh` | æ‰¹é‡ç¼–è¯‘ code/ ç›®å½•æ‰€æœ‰ç¤ºä¾‹ | éªŒè¯è¯­æ³•æ•™ç¨‹ |

## å¿«é€Ÿä½¿ç”¨

**æ¨èä½¿ç”¨äº¤äº’å¼èœå•**ï¼š
```bash
./run.sh    # å¯åŠ¨äº¤äº’å¼èœå•ï¼Œå¯é€‰æ‹©ä»»æ„è„šæœ¬è¿è¡Œ
```

## è¯¦ç»†è¯´æ˜

### 1. å¹³å°æ£€æµ‹ (`01_detect_platform.sh`)

è‡ªåŠ¨æ£€æµ‹å½“å‰æ“ä½œç³»ç»Ÿå¹³å°å¹¶é…ç½®ç›¸åº”çš„ç¼–è¯‘ç¯å¢ƒã€‚

```bash
./scripts/01_detect_platform.sh
```

**åŠŸèƒ½**ï¼š
- æ£€æµ‹æ“ä½œç³»ç»Ÿç±»å‹ï¼ˆmacOS/Ubuntuï¼‰
- æ£€æŸ¥å¿…è¦å·¥å…·æ˜¯å¦å®‰è£…
- ç”Ÿæˆ `.platform_config` é…ç½®æ–‡ä»¶

### 2. è‡ªåŠ¨æ„å»º (`02_auto_build.sh`)

ä¸€é”®æ„å»ºç¼–è¯‘å™¨ï¼ŒåŒ…æ‹¬è¯æ³•åˆ†æå™¨ã€è¯­æ³•åˆ†æå™¨å’Œä¸»ç¨‹åºã€‚

```bash
./scripts/02_auto_build.sh
```

**ç­‰ä»·äº**ï¼š
```bash
make clean
make
```

### 3. ç¤ºä¾‹æµ‹è¯• (`03_make_test.sh`)

ç¼–è¯‘å¹¶è¿è¡Œ `code/` ç›®å½•ä¸‹çš„æ‰€æœ‰ç¤ºä¾‹ç¨‹åºã€‚

```bash
./scripts/03_make_test.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
æ­£åœ¨ç¼–è¯‘å¹¶è¿è¡Œ code/ ç›®å½•ä¸‹çš„ç¤ºä¾‹ç¨‹åº...
[01_hello_world] ç¼–è¯‘æˆåŠŸ âœ“
[02_addition] ç¼–è¯‘æˆåŠŸ âœ“
...
```

### 4. æ¸…ç†æ„å»º (`04_make_clean.sh`)

æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰©å’Œä¸­é—´æ–‡ä»¶ã€‚

```bash
./scripts/04_make_clean.sh
```

**æ¸…ç†å†…å®¹**ï¼š
- `.o` ç›®æ ‡æ–‡ä»¶
- `.cc` ç”Ÿæˆçš„æºæ–‡ä»¶
- `.hh` ç”Ÿæˆçš„å¤´æ–‡ä»¶
- `compiler` å¯æ‰§è¡Œæ–‡ä»¶

### 5. è¿è¡Œæµ‹è¯•å¥—ä»¶ (`05_run_tests.sh`)

è¿è¡Œ `test/` ç›®å½•ä¸‹çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šã€‚

```bash
./scripts/05_run_tests.sh
```

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨ç¼–è¯‘æ‰€æœ‰æµ‹è¯•æ–‡ä»¶
- ç”Ÿæˆ Token æµã€ASTã€ç¬¦å·è¡¨ã€ä¸‰åœ°å€ç ã€LLVM IR
- è¿è¡Œå¹¶è®°å½•è¾“å‡º
- ç”Ÿæˆæ—¶é—´æˆ³å‘½åçš„æµ‹è¯•æŠ¥å‘Š
- ä¿å­˜åœ¨ `report/` ç›®å½•

**è¾“å‡ºç›®å½•**ï¼š
- `output/token/` - Token æµæ–‡ä»¶
- `output/symbols/` - ç¬¦å·è¡¨æ–‡ä»¶
- `output/ast/` - AST æ–‡ä»¶
- `output/tac/` - ä¸‰åœ°å€ç æ–‡ä»¶
- `output/llvm/` - LLVM IR æ–‡ä»¶
- `output/exec/` - å¯æ‰§è¡Œæ–‡ä»¶
- `output/ast_visualized/` - AST å¯è§†åŒ–å›¾ç‰‡

**æŠ¥å‘Šå†…å®¹**ï¼š
- æ¯ä¸ªæµ‹è¯•æ–‡ä»¶çš„ç¼–è¯‘ç»“æœ
- è¿è¡Œç»“æœå’Œå®Œæ•´è¾“å‡º
- æˆåŠŸ/å¤±è´¥ç»Ÿè®¡
- æµ‹è¯•ç”¨æ—¶

### 6. AST å¯è§†åŒ–å·¥å…· (`06_visualize_ast.sh`) â­

**ä¸€é”®ç”Ÿæˆ AST æ ‘çŠ¶å›¾** - å°† `code/` ç›®å½•ä¸‹çš„æ‰€æœ‰ç¨‹åºè½¬æ¢ä¸º PNG æ ¼å¼çš„å¯è§†åŒ–æ ‘çŠ¶å›¾ã€‚

```bash
# ç›´æ¥è¿è¡Œï¼Œè‡ªåŠ¨å¤„ç† code/ ç›®å½•æ‰€æœ‰æ–‡ä»¶
./scripts/06_visualize_ast.sh
```

#### å·¥ä½œæµç¨‹

1. è‡ªåŠ¨ç¼–è¯‘ `code/` ç›®å½•ä¸‹çš„ `.ppx` æ–‡ä»¶ç”Ÿæˆ `.ast`
2. å°† AST è½¬æ¢ä¸º PNG æ ¼å¼çš„æ ‘çŠ¶å›¾
3. è¾“å‡ºåˆ° `output/ast_visualized/` ç›®å½•

#### ä¾èµ–å®‰è£…

**macOS**:
```bash
brew install graphviz
pip3 install graphviz
```

**Ubuntu/Debian**:
```bash
sudo apt-get install graphviz
pip3 install graphviz
```

#### ä¸»è¦ç‰¹æ€§

- ğŸš€ **ä¸€é”®è¿è¡Œ** - æ— éœ€ä»»ä½•å‚æ•°
- âœ¨ **å…¨è‡ªåŠ¨** - ä»æºç åˆ°å¯è§†åŒ–å›¾
- ğŸ¨ **å½©è‰²æ˜¾ç¤º** - ä¸åŒèŠ‚ç‚¹ç±»å‹ä¸åŒé¢œè‰²
- ğŸ“Š **PNG æ ¼å¼** - é€šç”¨å›¾ç‰‡æ ¼å¼ï¼Œæ–¹ä¾¿æŸ¥çœ‹å’Œåˆ†äº«
- âš¡ **å¿«é€Ÿå¤„ç†** - è‡ªåŠ¨æ‰¹é‡å¤„ç†æ‰€æœ‰æ–‡ä»¶

#### è¾“å‡ºç¤ºä¾‹

```
output/ast_visualized/
â”œâ”€â”€ 01_hello_world.png
â”œâ”€â”€ 02_addition.png
â”œâ”€â”€ 03_subtraction.png
â”œâ”€â”€ 04_multiplication.png
â”œâ”€â”€ 05_division.png
â”œâ”€â”€ 06_float_formatting.png
â”œâ”€â”€ 07_variables.png
â”œâ”€â”€ 08_conditions.png
â”œâ”€â”€ 09_loops.png
â”œâ”€â”€ 10_functions.png
â”œâ”€â”€ 11_arrays.png
â”œâ”€â”€ 12_strings.png
â”œâ”€â”€ 13_switch.png
â””â”€â”€ 14_exceptions.png
```

#### ä½¿ç”¨ç¤ºä¾‹

**æ‰¹é‡å¤„ç†æ‰€æœ‰æ–‡ä»¶**ï¼š
```bash
./scripts/06_visualize_ast.sh
```

**å•ä¸ªæ–‡ä»¶å¯è§†åŒ–**ï¼š
```bash
# å…ˆç¼–è¯‘ç”Ÿæˆ AST æ–‡ä»¶
./compiler code/01_hello_world.ppx -ast

# ç„¶åå¯è§†åŒ–
python3 scripts/ast_visualizer.py code/01_hello_world.ast output/ast_visualized/01_hello_world.png
```

#### æ•…éšœæ’é™¤

**é—®é¢˜ï¼šgraphviz æœªå®‰è£…**
```bash
# é”™è¯¯ä¿¡æ¯ï¼šImportError: No module named 'graphviz'
# è§£å†³æ–¹æ³•ï¼šå®‰è£…ä¾èµ–
pip3 install graphviz
```

**é—®é¢˜ï¼šdot å‘½ä»¤æœªæ‰¾åˆ°**
```bash
# é”™è¯¯ä¿¡æ¯ï¼šExecutableNotFound: failed to execute ['dot', ...]
# è§£å†³æ–¹æ³•ï¼šå®‰è£… graphviz ç³»ç»ŸåŒ…
brew install graphviz  # macOS
# æˆ–
sudo apt-get install graphviz  # Ubuntu
```

### 7. æ‰¹é‡ç¼–è¯‘æµ‹è¯• (`07_build_code.sh`) â­

**å¿«é€ŸéªŒè¯è¯­æ³•æ•™ç¨‹** - æ‰¹é‡ç¼–è¯‘ `code/` ç›®å½•ä¸‹æ‰€æœ‰ç¤ºä¾‹ç¨‹åºï¼ŒéªŒè¯è¯­æ³•æ­£ç¡®æ€§ã€‚

```bash
./scripts/07_build_code.sh
```

#### åŠŸèƒ½è¯´æ˜

- è‡ªåŠ¨ç¼–è¯‘ `code/` ç›®å½•ä¸‹æ‰€æœ‰ä»¥æ•°å­—å¼€å¤´çš„ `.ppx` æ–‡ä»¶
- ç»Ÿè®¡ç¼–è¯‘æˆåŠŸå’Œå¤±è´¥çš„æ–‡ä»¶æ•°é‡
- ç”Ÿæˆæ¸…æ™°çš„æµ‹è¯•æŠ¥å‘Š

#### è¾“å‡ºç¤ºä¾‹

```
PPX è¯­æ³•æ•™ç¨‹æµ‹è¯•éªŒè¯

âœ“ 00_builtin_input_prompt
âœ“ 00_builtin_input
âœ“ 01_hello_world
âœ“ 02_comments
âœ“ 03_variable_int
...
âœ“ 63_compound_assign_full

  æµ‹è¯•æ€»ç»“
æ€»è®¡: 69
é€šè¿‡: 69
å¤±è´¥: 0

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

#### ä½¿ç”¨åœºæ™¯

- éªŒè¯è¯­æ³•æ•™ç¨‹çš„ç¤ºä¾‹ä»£ç 
- æ£€æŸ¥ç¼–è¯‘å™¨æ”¹åŠ¨åçš„å…¼å®¹æ€§
- æ‰¹é‡æµ‹è¯•æ‰€æœ‰åŸºç¡€ç¤ºä¾‹

#### ä¸å…¶ä»–è„šæœ¬çš„åŒºåˆ«

| è„šæœ¬ | ç›®å½• | è¿è¡Œ | æŠ¥å‘Š |
|------|------|------|------|
| `03_make_test.sh` | test/ | âœ“ | è¯¦ç»† |
| `05_run_tests.sh` | test/ | âœ“ | å®Œæ•´ |
| `07_build_code.sh` | code/ | âœ— | ç®€æ´ |

## ä½¿ç”¨å»ºè®®

### æ—¥å¸¸å¼€å‘æµç¨‹

1. **å¼€å§‹å¼€å‘**ï¼š
   ```bash
   ./scripts/01_detect_platform.sh  # é¦–æ¬¡è¿è¡Œ
   ./scripts/02_auto_build.sh       # æ„å»ºç¼–è¯‘å™¨
   ```

2. **æµ‹è¯•ä»£ç **ï¼š
   ```bash
   ./compiler code/your_program.ppx  # ç¼–è¯‘è¿è¡Œ
   ./scripts/07_build_code.sh        # æ‰¹é‡æµ‹è¯•ç¤ºä¾‹
   ```

3. **æŸ¥çœ‹ç¼–è¯‘ä¸­é—´ç»“æœ**ï¼š
   ```bash
   ./compiler code/your_program.ppx -tokens   # Token æµ
   ./compiler code/your_program.ppx -symbols  # ç¬¦å·è¡¨
   ./compiler code/your_program.ppx -ast      # AST
   ./compiler code/your_program.ppx -tac      # ä¸‰åœ°å€ç 
   ./compiler code/your_program.ppx -llvm     # LLVM IR
   ```

4. **æŸ¥çœ‹ AST å¯è§†åŒ–**ï¼š
   ```bash
   ./scripts/06_visualize_ast.sh    # å¯è§†åŒ– AST
   ```

5. **è¿è¡Œæµ‹è¯•**ï¼š
   ```bash
   ./scripts/05_run_tests.sh        # å®Œæ•´æµ‹è¯•
   ```

6. **æ¸…ç†é¡¹ç›®**ï¼š
   ```bash
   ./scripts/04_make_clean.sh       # æ¸…ç†æ„å»º
   ```

### æœ€ä½³å®è·µ

- âœ… ä½¿ç”¨ `./run.sh` äº¤äº’å¼èœå•ï¼Œé¿å…è®°å¿†å‘½ä»¤
- âœ… å®šæœŸè¿è¡Œæµ‹è¯•å¥—ä»¶ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸
- âœ… ä½¿ç”¨ `07_build_code.sh` å¿«é€ŸéªŒè¯è¯­æ³•æ•™ç¨‹
- âœ… æäº¤ä»£ç å‰æ¸…ç†æ„å»ºäº§ç‰©
- âœ… ä½¿ç”¨ AST å¯è§†åŒ–å·¥å…·ç†è§£ç¨‹åºç»“æ„

## ç›¸å…³æ–‡æ¡£

- [FAQ.md](./FAQ.md) - å¸¸è§é—®é¢˜è§£ç­”
- [æ•…éšœæ’é™¤.md](./æ•…éšœæ’é™¤.md) - é—®é¢˜è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ
