# PiPiXia 脚本工具使用指南

项目提供了一系列便捷的脚本工具，位于 `scripts/` 目录，用于自动化常见的开发任务。

## 脚本列表

| 脚本 | 功能 | 使用场景 |
|------|------|----------|
| `01_detect_platform.sh` | 检测平台并配置编译环境 | 首次安装或切换平台 |
| `02_auto_build.sh` | 自动构建编译器 | 快速构建项目 |
| `03_make_test.sh` | 编译并运行 code/ 目录示例 | 测试示例代码 |
| `04_make_clean.sh` | 清理构建产物 | 清理项目 |
| `05_run_tests.sh` | 运行 test/ 目录测试套件 | 运行完整测试 |
| `06_visualize_ast.sh` | 将 AST 转换为图形化显示 | AST 可视化 |
| `07_build_code.sh` | 批量编译 code/ 目录所有示例 | 验证语法教程 |

## 快速使用

**推荐使用交互式菜单**：
```bash
./run.sh    # 启动交互式菜单，可选择任意脚本运行
```

## 详细说明

### 1. 平台检测 (`01_detect_platform.sh`)

自动检测当前操作系统平台并配置相应的编译环境。

```bash
./scripts/01_detect_platform.sh
```

**功能**：
- 检测操作系统类型（macOS/Ubuntu）
- 检查必要工具是否安装
- 生成 `.platform_config` 配置文件

### 2. 自动构建 (`02_auto_build.sh`)

一键构建编译器，包括词法分析器、语法分析器和主程序。

```bash
./scripts/02_auto_build.sh
```

**等价于**：
```bash
make clean
make
```

### 3. 示例测试 (`03_make_test.sh`)

编译并运行 `code/` 目录下的所有示例程序。

```bash
./scripts/03_make_test.sh
```

**输出示例**：
```
正在编译并运行 code/ 目录下的示例程序...
[01_hello_world] 编译成功 ✓
[02_addition] 编译成功 ✓
...
```

### 4. 清理构建 (`04_make_clean.sh`)

清理所有构建产物和中间文件。

```bash
./scripts/04_make_clean.sh
```

**清理内容**：
- `.o` 目标文件
- `.cc` 生成的源文件
- `.hh` 生成的头文件
- `compiler` 可执行文件

### 5. 运行测试套件 (`05_run_tests.sh`)

运行 `test/` 目录下的所有测试用例，并生成详细的测试报告。

```bash
./scripts/05_run_tests.sh
```

**功能**：
- 自动编译所有测试文件
- 运行并记录输出
- 生成时间戳命名的测试报告
- 保存在 `report/` 目录

**报告内容**：
- 每个测试文件的编译结果
- 运行结果和完整输出
- 成功/失败统计
- 测试用时

### 6. AST 可视化工具 (`06_visualize_ast.sh`) ⭐

**一键生成 AST 树状图** - 将 `code/` 目录下的所有程序转换为 PNG 格式的可视化树状图。

```bash
# 直接运行，自动处理 code/ 目录所有文件
./scripts/06_visualize_ast.sh
```

#### 工作流程

1. 自动编译 `code/` 目录下的 `.ppx` 文件生成 `.ast`
2. 将 AST 转换为 PNG 格式的树状图
3. 输出到 `output/ast_visualized/` 目录

#### 依赖安装

**macOS**:
```bash
brew install graphviz
pip3 install graphviz
```

**Ubuntu/Debian**:
```bash
sudo apt-get install graphviz
pip3 install graphviz
```

#### 主要特性

- 🚀 **一键运行** - 无需任何参数
- ✨ **全自动** - 从源码到可视化图
- 🎨 **彩色显示** - 不同节点类型不同颜色
- 📊 **PNG 格式** - 通用图片格式，方便查看和分享
- ⚡ **快速处理** - 自动批量处理所有文件

#### 输出示例

```
output/ast_visualized/
├── 01_hello_world.png
├── 02_addition.png
├── 03_subtraction.png
├── 04_multiplication.png
├── 05_division.png
├── 06_float_formatting.png
├── 07_variables.png
├── 08_conditions.png
├── 09_loops.png
├── 10_functions.png
├── 11_arrays.png
├── 12_strings.png
├── 13_switch.png
└── 14_exceptions.png
```

#### 使用示例

**批量处理所有文件**：
```bash
./scripts/06_visualize_ast.sh
```

**单个文件可视化**：
```bash
# 先编译生成 AST 文件
./compiler code/01_hello_world.ppx -ast

# 然后可视化
python3 scripts/ast_visualizer.py code/01_hello_world.ast output/ast_visualized/01_hello_world.png
```

#### 故障排除

**问题：graphviz 未安装**
```bash
# 错误信息：ImportError: No module named 'graphviz'
# 解决方法：安装依赖
pip3 install graphviz
```

**问题：dot 命令未找到**
```bash
# 错误信息：ExecutableNotFound: failed to execute ['dot', ...]
# 解决方法：安装 graphviz 系统包
brew install graphviz  # macOS
# 或
sudo apt-get install graphviz  # Ubuntu
```

### 7. 批量编译测试 (`07_build_code.sh`) ⭐

**快速验证语法教程** - 批量编译 `code/` 目录下所有示例程序，验证语法正确性。

```bash
./scripts/07_build_code.sh
```

#### 功能说明

- 自动编译 `code/` 目录下所有以数字开头的 `.ppx` 文件
- 统计编译成功和失败的文件数量
- 生成清晰的测试报告

#### 输出示例

```
PPX 语法教程测试验证

✓ 00_builtin_input_prompt
✓ 00_builtin_input
✓ 01_hello_world
✓ 02_comments
✓ 03_variable_int
...
✓ 63_compound_assign_full

  测试总结
总计: 69
通过: 69
失败: 0

🎉 所有测试通过！
```

#### 使用场景

- 验证语法教程的示例代码
- 检查编译器改动后的兼容性
- 批量测试所有基础示例

#### 与其他脚本的区别

| 脚本 | 目录 | 运行 | 报告 |
|------|------|------|------|
| `03_make_test.sh` | test/ | ✓ | 详细 |
| `05_run_tests.sh` | test/ | ✓ | 完整 |
| `07_build_code.sh` | code/ | ✗ | 简洁 |

## 使用建议

### 日常开发流程

1. **开始开发**：
   ```bash
   ./scripts/01_detect_platform.sh  # 首次运行
   ./scripts/02_auto_build.sh       # 构建编译器
   ```

2. **测试代码**：
   ```bash
   ./compiler code/your_program.ppx  # 编译运行
   ./scripts/07_build_code.sh        # 批量测试示例
   ```

3. **查看 AST**：
   ```bash
   ./scripts/06_visualize_ast.sh    # 可视化 AST
   ```

4. **运行测试**：
   ```bash
   ./scripts/05_run_tests.sh        # 完整测试
   ```

5. **清理项目**：
   ```bash
   ./scripts/04_make_clean.sh       # 清理构建
   ```

### 最佳实践

- ✅ 使用 `./run.sh` 交互式菜单，避免记忆命令
- ✅ 定期运行测试套件，确保功能正常
- ✅ 使用 `07_build_code.sh` 快速验证语法教程
- ✅ 提交代码前清理构建产物
- ✅ 使用 AST 可视化工具理解程序结构

## 相关文档

- [FAQ.md](./FAQ.md) - 常见问题解答
- [故障排除.md](./故障排除.md) - 问题诊断和解决方案
