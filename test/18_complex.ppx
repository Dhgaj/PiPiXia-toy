# 综合复杂测试
# 测试多种语法特性的组合使用

# 计算数组平均值
func array_average(arr: int[5]): double {
    let sum: int = 0
    let i: int = 0
    while (i < 5) {
        sum = sum + arr[i]
        i = i + 1
    }
    return sum / 5.0
}

# 冒泡排序（部分）
func bubble_sort_step(arr: int[5]) {
    let i: int = 0
    while (i < 4) {
        if (arr[i] > arr[i + 1]) {
            let temp: int = arr[i]
            arr[i] = arr[i + 1]
            arr[i + 1] = temp
        }
        i = i + 1
    }
}

# 判断素数
func is_prime(n: int): bool {
    if (n <= 1) {
        return false
    }
    if (n == 2) {
        return true
    }
    
    let i: int = 2
    while (i < n) {
        if ((n % i) == 0) {
            return false
        }
        i = i + 1
    }
    return true
}

func main(): int {
    print("===== 综合复杂测试 =====")
    print("")
    
    # 测试1: 数组统计
    print("1. 数组统计分析:")
    let scores: int[5] = [85, 92, 78, 95, 88]
    
    let total: int = 0
    let max: int = scores[0]
    let min: int = scores[0]
    
    let idx: int = 0
    while (idx < 5) {
        let score: int = scores[idx]
        total = total + score
        if (score > max) {
            max = score
        }
        if (score < min) {
            min = score
        }
        idx = idx + 1
    }
    
    let avg: double = array_average(scores)
    print("  总分: ${total}")
    print("  平均分: ${avg}")
    print("  最高分: ${max}")
    print("  最低分: ${min}")
    print("")
    
    # 测试2: 排序
    print("2. 冒泡排序:")
    let nums: int[5] = [64, 34, 25, 12, 22]
    print("  排序前: 64, 34, 25, 12, 22")
    
    let pass: int = 0
    while (pass < 4) {
        bubble_sort_step(nums)
        pass = pass + 1
    }
    
    print("  排序后:")
    let j: int = 0
    while (j < 5) {
        print("    ${nums[j]}")
        j = j + 1
    }
    print("")
    
    # 测试3: 素数检测
    print("3. 素数检测 (2-20):")
    let num: int = 2
    while (num <= 20) {
        if (is_prime(num)) {
            print("  ${num} 是素数")
        }
        num = num + 1
    }
    print("")
    
    # 测试4: 嵌套循环 - 矩阵运算
    print("4. 矩阵求和:")
    let mat: int[3][3] = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
    let mat_sum: int = 0
    
    let row: int = 0
    while (row < 3) {
        let col: int = 0
        while (col < 3) {
            mat_sum = mat_sum + mat[row][col]
            col = col + 1
        }
        row = row + 1
    }
    print("  矩阵元素总和: ${mat_sum} (应输出: 45)")
    print("")
    
    # 测试5: 字符串处理
    print("5. 动态字符串生成:")
    let i: int = 1
    while (i <= 5) {
        let msg: string = "第 ${i} 次迭代"
        print("  ${msg}")
        i = i + 1
    }
    print("")
    
    print("综合测试完成！")
    return 0
}
